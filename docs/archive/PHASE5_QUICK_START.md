# Zmage v3 - Phase 5 Quick Start Guide

## ğŸš€ å¿«é€Ÿå¼€å§‹

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å¿«é€Ÿå¯åŠ¨ Zmage v3 çš„ Phase 5 æ–°åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ•°æ®åˆ†æã€æ‰¹é‡åˆ†äº«å’Œä¼˜åŒ–åçš„ç•Œé¢ã€‚

---

## ğŸ“‹ å‰ç½®è¦æ±‚

- Node.js 18+ 
- npm æˆ– yarn
- SQLite (å¼€å‘ç¯å¢ƒ) æˆ– PostgreSQL (ç”Ÿäº§ç¯å¢ƒ)
- Elasticsearch 8.x (å¯é€‰ï¼Œç”¨äºé«˜çº§æœç´¢)
- Redis (å¯é€‰ï¼Œç”¨äºé˜Ÿåˆ—å’Œç¼“å­˜)

---

## ğŸ”§ ç¯å¢ƒè®¾ç½®

### 1. å…‹éš†ä»“åº“

```bash
git clone https://github.com/zzw4257/zmage.git
cd zmage
git checkout feat/v3.0.0-infrastructure
```

### 2. å®‰è£…ä¾èµ–

```bash
cd frontend
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# æ•°æ®åº“
DATABASE_URL="file:./prisma/dev.db"

# NextAuth
NEXTAUTH_SECRET="your-secret-key-here"
NEXTAUTH_URL="http://localhost:3000"

# Elasticsearch (å¯é€‰)
ELASTICSEARCH_URL="http://localhost:9200"

# Redis (å¯é€‰)
REDIS_URL="redis://localhost:6379"

# AI æœåŠ¡ (å¯é€‰)
OPENAI_API_KEY="your-openai-key"
```

### 4. åˆå§‹åŒ–æ•°æ®åº“

```bash
# æ¨é€æ•°æ®åº“ schema
npm run db:push

# ç”Ÿæˆ Prisma Client
npm run db:generate
```

### 5. åˆ›å»ºç”¨æˆ·è´¦å·

```bash
npm run create-user
```

æŒ‰æç¤ºè¾“å…¥ï¼š
- Username: `admin`
- Email: `admin@zmage.local`
- Password: `your-secure-password`

---

## ğŸ¯ å¯åŠ¨åº”ç”¨

### å¼€å‘æ¨¡å¼

```bash
npm run dev
```

è®¿é—®: `http://localhost:3000`

### ç”Ÿäº§æ¨¡å¼

```bash
npm run build
npm run start
```

---

## ğŸ“Š Phase 5 æ–°åŠŸèƒ½æŒ‡å—

### 1. æ•°æ®åˆ†æç³»ç»Ÿ

#### è®¿é—®åˆ†æä»ªè¡¨æ¿

1. ç™»å½•ç³»ç»Ÿ
2. ç‚¹å‡»å·¦ä¾§è¾¹æ  **"ç®¡ç†"** åˆ†ç»„
3. é€‰æ‹© **"æ•°æ®åˆ†æ"** (å¸¦ "New" æ ‡ç­¾)

#### åŠŸèƒ½ç‰¹æ€§

**æ¦‚è§ˆå¡ç‰‡** - å¿«é€ŸæŸ¥çœ‹å…³é”®æŒ‡æ ‡
- æ´»è·ƒç”¨æˆ· (DAU/WAU/MAU)
- å­˜å‚¨ä½¿ç”¨æƒ…å†µ
- ä»Šæ—¥æ´»åŠ¨ç»Ÿè®¡
- AI ä½¿ç”¨æƒ…å†µ

**è¯¦ç»†åˆ†æ** - å¤šæ ‡ç­¾æ·±åº¦åˆ†æ
- **æ¦‚è§ˆ**: ç”¨æˆ·ç»Ÿè®¡ + ç•™å­˜ç‡
- **å­˜å‚¨**: æ–‡ä»¶ç±»å‹åˆ†å¸ƒ + ç”¨æˆ·æ’å
- **æ´»åŠ¨**: ä¸Šä¼ /æµè§ˆ/ä¸‹è½½è¶‹åŠ¿
- **AI**: æ¨¡å‹ä½¿ç”¨ + Token æ¶ˆè€—

**æ•°æ®å¯¼å‡º**
- ç‚¹å‡»å³ä¸Šè§’ "å¯¼å‡º CSV" æŒ‰é’®
- æ”¯æŒ CSV å’Œ JSON æ ¼å¼

#### API ä½¿ç”¨ç¤ºä¾‹

```bash
# è·å–æ¦‚è§ˆæ•°æ®
curl http://localhost:3000/api/analytics/overview

# è·å–å­˜å‚¨ç»Ÿè®¡ (æœ€è¿‘7å¤©)
curl http://localhost:3000/api/analytics/storage?days=7

# è·å– AI ä½¿ç”¨ç»Ÿè®¡
curl http://localhost:3000/api/analytics/ai-usage?days=30

# å¯¼å‡ºæ•°æ®
curl http://localhost:3000/api/analytics/export?type=overview&format=csv -o overview.csv
```

### 2. æ‰¹é‡åˆ†äº«ç³»ç»Ÿ

#### åˆ›å»ºæ‰¹é‡åˆ†äº«

1. åœ¨å›¾ç‰‡åº“ä¸­é€‰æ‹©å¤šå¼ å›¾ç‰‡
2. ç‚¹å‡» "æ‰¹é‡åˆ†äº«" æŒ‰é’®
3. é…ç½®åˆ†äº«é€‰é¡¹ï¼š
   - åˆ†äº«åç§°å’Œæè¿°
   - è®¿é—®å¯†ç  (å¯é€‰)
   - è¿‡æœŸæ—¶é—´
   - ä¸‹è½½æƒé™
   - ZIP ä¸‹è½½ (å¯é€‰)

#### ç®¡ç†åˆ†äº«é“¾æ¥

è®¿é—® `/share` é¡µé¢æŸ¥çœ‹ï¼š
- æ‰€æœ‰åˆ†äº«é“¾æ¥
- è®¿é—®ç»Ÿè®¡
- é“¾æ¥ç®¡ç† (ç¼–è¾‘/åˆ é™¤)

#### API ä½¿ç”¨ç¤ºä¾‹

```bash
# åˆ›å»ºæ‰¹é‡åˆ†äº«
curl -X POST http://localhost:3000/api/share/bulk/create \
  -H "Content-Type: application/json" \
  -d '{
    "mediaIds": ["media1", "media2"],
    "title": "æˆ‘çš„ç…§ç‰‡é›†",
    "expiresAt": "2024-12-31T23:59:59Z"
  }'

# æŸ¥çœ‹åˆ†äº«ç»Ÿè®¡
curl http://localhost:3000/api/share/bulk/{shareId}/stats

# ä¸‹è½½ ZIP
curl http://localhost:3000/api/share/bulk/{shareId}/download -o photos.zip
```

### 3. ä¼˜åŒ–åçš„ä¾§è¾¹æ 

#### æ–°çš„èœå•ç»“æ„

**æ ¸å¿ƒåŠŸèƒ½** (é»˜è®¤å±•å¼€)
- å›¾ç‰‡åº“
- è§†é¢‘åº“
- ä¸Šä¼ 
- æœç´¢
- æ¢ç´¢

**AI åŠŸèƒ½** (é»˜è®¤å±•å¼€)
- AI ç”Ÿæˆ
- åˆ›ä½œ
- MCP (Beta)

**ç®¡ç†** (é»˜è®¤æŠ˜å )
- åˆ†äº«
- æ•°æ®åˆ†æ (New)
- ä»»åŠ¡
- å¼€å‘å·¥åŠ
- è®¾ç½®

#### äº¤äº’ç‰¹æ€§

- ç‚¹å‡»åˆ†ç»„æ ‡é¢˜æŠ˜å /å±•å¼€
- ä¾§è¾¹æ å¯æ•´ä½“æŠ˜å ä¸ºå›¾æ ‡æ¨¡å¼
- Hover æ˜¾ç¤ºå®Œæ•´èœå•åç§°
- å¾½ç« æ ‡è¯†æ–°åŠŸèƒ½å’Œ Beta åŠŸèƒ½

---

## ğŸ”„ æ•°æ®èšåˆä»»åŠ¡

### æ‰‹åŠ¨è¿è¡Œèšåˆ

```bash
# èšåˆæ˜¨å¤©çš„æ•°æ®
npm run stats:aggregate

# èšåˆä»Šå¤©çš„æ•°æ®
npm run stats:today

# å›å¡«å†å²æ•°æ®
npm run stats:backfill
```

### è®¾ç½®å®šæ—¶ä»»åŠ¡ (Cron)

æ·»åŠ åˆ° crontab:

```bash
# æ¯å¤©å‡Œæ™¨ 1 ç‚¹è¿è¡Œæ•°æ®èšåˆ
0 1 * * * cd /path/to/zmage/frontend && npm run stats:aggregate
```

æˆ–ä½¿ç”¨ PM2:

```bash
pm2 start npm --name "zmage-stats" -- run stats:aggregate
pm2 save
```

---

## ğŸ§ª æµ‹è¯•åŠŸèƒ½

### è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
# æµ‹è¯•æ‰¹é‡åˆ†äº«åŠŸèƒ½
npm run test:bulk-share

# æµ‹è¯•é«˜çº§åˆ†äº«åŠŸèƒ½
npm run test:share
```

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

#### æ•°æ®åˆ†ææµ‹è¯•
1. ä¸Šä¼ ä¸€äº›å›¾ç‰‡
2. è®¿é—® `/analytics` é¡µé¢
3. æŸ¥çœ‹å„é¡¹ç»Ÿè®¡æ•°æ®
4. æµ‹è¯•å¯¼å‡ºåŠŸèƒ½
5. åˆ·æ–°æ•°æ®éªŒè¯å®æ—¶æ€§

#### æ‰¹é‡åˆ†äº«æµ‹è¯•
1. åœ¨å›¾ç‰‡åº“é€‰æ‹© 5-10 å¼ å›¾ç‰‡
2. åˆ›å»ºæ‰¹é‡åˆ†äº«é“¾æ¥
3. è®¾ç½®å¯†ç å’Œè¿‡æœŸæ—¶é—´
4. è®¿é—®åˆ†äº«é“¾æ¥
5. æµ‹è¯• ZIP ä¸‹è½½åŠŸèƒ½

---

## ğŸ“± ç§»åŠ¨ç«¯é€‚é…

æ‰€æœ‰æ–°åŠŸèƒ½å‡å·²é€‚é…ç§»åŠ¨ç«¯ï¼š

- **å“åº”å¼å¸ƒå±€**: è‡ªåŠ¨é€‚åº”ä¸åŒå±å¹•å°ºå¯¸
- **è§¦æ‘¸ä¼˜åŒ–**: æ‰‹åŠ¿æ“ä½œå‹å¥½
- **ä¾§è¾¹æ **: ç§»åŠ¨ç«¯å¯æ»‘å‡º/æ”¶èµ·
- **åˆ†æé¡µé¢**: å¡ç‰‡å †å å¸ƒå±€

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“ç›¸å…³

**é—®é¢˜**: Prisma Client æœªç”Ÿæˆ
```bash
# è§£å†³æ–¹æ¡ˆ
npm run db:generate
```

**é—®é¢˜**: æ•°æ®åº“è¿ç§»å¤±è´¥
```bash
# é‡ç½®æ•°æ®åº“ (å¼€å‘ç¯å¢ƒ)
npm run db:reset

# æˆ–ä½¿ç”¨ push (ä¸åˆ›å»ºè¿ç§»æ–‡ä»¶)
npm run db:push
```

### 2. åˆ†ææ•°æ®ä¸ºç©º

**é—®é¢˜**: è®¿é—®åˆ†æé¡µé¢æ˜¾ç¤º 0 æ•°æ®

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿å·²ä¸Šä¼ å›¾ç‰‡å’Œä½¿ç”¨è¿‡ç³»ç»Ÿ
2. è¿è¡Œæ•°æ®èšåˆä»»åŠ¡:
   ```bash
   npm run stats:today
   ```
3. åˆ·æ–°åˆ†æé¡µé¢

### 3. æ‰¹é‡åˆ†äº«å¤±è´¥

**é—®é¢˜**: åˆ›å»ºåˆ†äº«æ—¶æŠ¥é”™

**æ£€æŸ¥æ¸…å•**:
- ç¡®ä¿å·²é€‰æ‹©å›¾ç‰‡
- æ£€æŸ¥å›¾ç‰‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- éªŒè¯å­˜å‚¨é…ç½®æ­£ç¡®
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

### 4. ä¾§è¾¹æ ä¸æ˜¾ç¤ºæ–°èœå•

**è§£å†³æ–¹æ¡ˆ**:
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
2. ç¡¬åˆ·æ–°é¡µé¢ (Ctrl+Shift+R / Cmd+Shift+R)
3. æ£€æŸ¥ Collapsible ç»„ä»¶æ˜¯å¦å®‰è£…:
   ```bash
   npm install @radix-ui/react-collapsible
   ```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### å¼€å‘ç¯å¢ƒ

- ä½¿ç”¨ SQLite å¿«é€Ÿå¼€å‘
- å°æ•°æ®é›†æµ‹è¯•åŠŸèƒ½
- å¯ç”¨ Turbopack åŠ é€Ÿæ„å»º

### ç”Ÿäº§ç¯å¢ƒ

**æ•°æ®åº“ä¼˜åŒ–**:
```bash
# è¿ç§»åˆ° PostgreSQL
npm run migrate:to-postgres
```

**ç¼“å­˜ä¼˜åŒ–**:
- å¯ç”¨ Redis ç¼“å­˜ç»Ÿè®¡æ•°æ®
- é…ç½® Elasticsearch åŠ é€Ÿæœç´¢

**æœåŠ¡å™¨é…ç½®**:
- ä½¿ç”¨ PM2 è¿›ç¨‹ç®¡ç†
- é…ç½® Nginx åå‘ä»£ç†
- å¯ç”¨ gzip å‹ç¼©

---

## ğŸ” å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **: é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹
2. **é…ç½® HTTPS**: ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS
3. **é™åˆ¶ API è®¿é—®**: æ·»åŠ é€Ÿç‡é™åˆ¶
4. **å®šæœŸå¤‡ä»½**: å¤‡ä»½æ•°æ®åº“å’Œä¸Šä¼ æ–‡ä»¶
5. **ç›‘æ§æ—¥å¿—**: è®¾ç½®æ—¥å¿—å‘Šè­¦

---

## ğŸ“š æ›´å¤šèµ„æº

### æ–‡æ¡£
- [Phase 5 Day 22-23 è¯¦ç»†æ–‡æ¡£](./PHASE5_DAY22-23_ANALYTICS_API.md)
- [Phase 5 Day 20-21 æ•°æ®åˆ†æåŸºç¡€](./PHASE5_DAY20-21_DATA_ANALYTICS.md)
- [Phase 5 Day 18-19 æ‰¹é‡åˆ†äº«](./PHASE5_DAY18-19_BULK_SHARE.md)

### API å‚è€ƒ
- Analytics API: `/api/analytics/*`
- Bulk Share API: `/api/share/bulk/*`
- Export API: `/api/analytics/export`

### ä»£ç ç¤ºä¾‹
- æµ‹è¯•è„šæœ¬: `frontend/scripts/test-*.ts`
- æœåŠ¡å±‚: `frontend/lib/analytics/analytics-service.ts`
- ç»„ä»¶: `frontend/app/(main)/analytics/page.tsx`

---

## ğŸ’¬ è·å–å¸®åŠ©

- **GitHub Issues**: https://github.com/zzw4257/zmage/issues
- **æ–‡æ¡£**: æŸ¥çœ‹ `docs/` ç›®å½•
- **æ—¥å¿—**: æ£€æŸ¥ `logs/` ç›®å½•

---

## ğŸ‰ å¼€å§‹ä½¿ç”¨

æ­å–œï¼ä½ å·²ç»å‡†å¤‡å¥½ä½“éªŒ Zmage v3 çš„ Phase 5 æ–°åŠŸèƒ½äº†ã€‚

**æ¨èæµç¨‹**:
1. âœ… ä¸Šä¼ ä¸€äº›æµ‹è¯•å›¾ç‰‡
2. âœ… ä½“éªŒæ‰¹é‡åˆ†äº«åŠŸèƒ½
3. âœ… æŸ¥çœ‹æ•°æ®åˆ†æä»ªè¡¨æ¿
4. âœ… æ¢ç´¢ä¼˜åŒ–åçš„å¯¼èˆªç•Œé¢
5. âœ… å°è¯•æ•°æ®å¯¼å‡ºåŠŸèƒ½

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ ğŸš€

---

**æœ€åæ›´æ–°**: 2024-01-15  
**ç‰ˆæœ¬**: Phase 5 (v3.0.0)  
**ç»´æŠ¤è€…**: zzw4257