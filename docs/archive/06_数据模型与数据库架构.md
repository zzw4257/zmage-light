# 5. 数据模型与数据库架构

Zmage 的数据基石由 Prisma Schema 定义，确保了模型的健壮性和演进能力。

*   **核心实体**: `User`, `Image`, `Video`, `Album`, `Tag`, `Subscription`, `PaymentTransaction`。
*   **关系设计**:
    *   `User` 与 `Image`/`Video`/`Album` 为一对多。
    *   `Image`/`Video` 与 `Tag` 通过 `ImageTag` 中间表实现多对多。
    *   `Image`/`Video` 与 `Album` 通过 `ImageAlbum` 中间表实现多对多。
    *   所有核心资源表均包含 `userId` 字段，并建立索引，实现高效的多租户数据隔离。
*   **数据一致性**: 广泛使用外键约束和 `onDelete: Cascade` 策略，确保在删除用户或相册等主体时，其关联数据能够被干净地级联删除。
*   **可扩展字段**: `Album.smartRules` 和 `Image.exif` 等字段采用 `Json` 类型，为未来新增规则和元数据提供了极大的灵活性，无需频繁修改表结构。