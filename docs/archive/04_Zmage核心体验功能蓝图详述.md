# 3. Zmage 核心体验：功能蓝图详述

## 3.1 生命之流：统一媒体采集与智能预处理

Zmage 的起点是包容万象的采集能力，它不仅是文件的入口，更是记忆初始化的第一站。

*   **多源统一上传**:
    *   **本地上传**: 支持文件/文件夹拖拽、批量选择，移动端调用原生相册。
    *   **URL 导入**: 从网络链接直接导入图片/视频，后台异步下载处理。
    *   **探索导入**: 内置"探索"页，可从 Google Images 等来源搜索并一键入库，作为灵感来源。
    *   **插件化接入**: 设计插件架构，未来可支持从 iCloud、Google Photos 等云服务一键迁移导入。

*   **智能预处理管线**:
    *   **元数据深度解析 (EXIF & Beyond)**: 使用 `exifr` 深度提取拍摄时间、地理位置、相机/镜头型号、光圈快门等技术参数。对于视频，则预提取分辨率、时长、编码等信息。
    *   **智能归档命名**: 文件以 `cuid` 重命名，杜绝冲突，同时在数据库中保留原始文件名，兼顾唯一性与可追溯性。
    *   **标准化预览**: 自动为所有图片生成统一尺寸的缩略图，为视频截取关键帧作为封面，保证在网格视图下的视觉整齐与加载性能。
    *   **可选的首次 AI 分析**: 用户可开启"上传时自动分析"选项。开启后，Gemini 会在后台为新媒体生成初步的标签、描述和色彩分析，实现"零配置"的智能整理。

## 3.2 记忆宫殿：多维动态组织与智能策展

Zmage 的核心是强大的组织能力，它超越了传统的文件夹模式，提供了一个动态、多维的"记忆宫殿"。

*   **相册 (Albums)**:
    *   **手动相册**: 用户自由创建，通过拖拽或多选方式将媒体添加入册，并支持自定义排序。
    *   **智能相册**: 基于一套强大的规则引擎，动态聚合符合条件的媒体。规则包括：
        *   **时间**: 拍摄于"去年夏天"、"2024年10月"、"最近一周"等自然语言或精确范围。
        *   **地点**: 拍摄于"杭州西湖"附近（基于GPS半径搜索）、或包含"城市"标签。
        *   **人物/宠物**: （规划中）基于人脸/宠物识别，自动创建"张三的照片"、"我的猫"等相册。
        *   **相机/镜头**: "所有由 Leica Q3 拍摄的照片"。
        *   **技术参数**: "所有光圈大于f/1.8的人像照片"。
        *   **标签/评分**: "所有包含'旅行'标签且评分4星以上的照片"。
    *   **嵌套与层级**: 支持相册嵌套，构建如"2025年 -> 欧洲旅行 -> 巴黎"这样的层级化结构。

*   **标签系统 (Tags)**:
    *   **多源标签**: 融合 **AI生成标签**、**用户自定义标签** 和 **系统标签**（如"已编辑"、"收藏"）。AI 标签会附带置信度，并以不同样式展示，便于区分。
    *   **标签管理**: 提供独立的标签管理界面，支持对标签进行合并、重命名、添加描述和颜色标记。
    *   **标签组**: 用户可创建标签组，如将"山脉"、"森林"、"湖泊"归入"自然风光"组，便于批量筛选。

*   **详情视图 (Detail View)**:
    *   **信息面板**: 聚合展示基本信息、EXIF、AI 描述、评分、备忘录、色彩分析和所属相册等所有维度信息。
    *   **备忘录**: 支持 Markdown 格式的富文本笔记，记录照片背后的故事。
    *   **色彩分析**: 自动提取图片的主色板和突出颜色，为设计师和艺术家提供灵感。

## 3.3 时光探针：即时混合搜索与对话式探索

Zmage 的搜索是连接用户与海量记忆库的"时光探针"，它融合了传统的结构化查询与前沿的多模态、语义化理解能力，旨在实现"想到即找到"。

### 基础文本与结构化搜索 (/search)

*   **关键词搜索**:
    *   **全文检索**: 覆盖**文件名、用户自定义标签、AI生成标签、备忘录内容、AI生成描述、OCR识别文本**等所有文本字段。
    *   **智能分词**: 支持中英文混合搜索及智能分词。
*   **高级筛选器 (侧边栏)**:
    *   **相册限定**: 可选择一个或多个相册作为搜索范围。
    *   **时间范围**:
        *   支持精确的日期范围选择 (开始/结束日期)。
        *   支持自然语言预设，如"今天"、"本周"、"上个月"、"去年夏天"。
    *   **媒体类型**: 筛选"图片"、"视频"、"Live Photo动态图"、"全景图"。
    *   **收藏与评分**: 筛选"已收藏"或评分在特定范围（如 "4星及以上"）的媒体。
    *   **EXIF 参数**:
        *   按**相机型号**或**镜头型号**筛选。
        *   按**光圈**、**快门速度**、**ISO**范围筛选。
    *   **图像属性**:
        *   按**形状**筛选 (横向/纵向/方形)。
        *   按**分辨率**范围筛选。
    *   **处理状态**: 筛选"未处理"、"已编辑"、"AI已分析"的媒体。
*   **排序 (10+ 种)**:
    *   **时间**: **上传时间** (升/降序)、**拍摄时间** (升/降序)。
    *   **元数据**: **文件名** (A-Z/Z-A)、**文件大小** (大-小/小-大)。
    *   **用户交互**: **评分** (高-低/低-高)、**浏览次数** (多-少/少-多)。
    *   **相关度**: (默认) 基于搜索算法的综合相关度排序。
*   **分页与视图**:
    *   **完整分页器**: 支持每页数量选择、前后翻页、直接跳转指定页码。
    *   **结果视图切换**: 搜索结果同样支持网格、列表、瀑布流三种视图模式。

### 高级与多模态搜索

为了实现超越关键词匹配的深度搜索能力，Zmage 的架构设计中引入了 **Elasticsearch** 作为一个专门的、高性能的搜索与分析引擎。它与主数据库 (SQLite/MySQL) 并行存在，负责处理所有复杂的查询任务。

**为什么选择 Elasticsearch?**

*   **分布式与可扩展**: 天然支持水平扩展，可以通过增加节点来轻松应对未来千万甚至亿级媒体库的增长。
*   **全文本搜索**: 基于 Apache Lucene 构建，提供业界顶级的全文本搜索能力，支持分词、模糊查询、相关度排序等。
*   **多模态支持**: 核心优势在于其**向量搜索 (Vector Search)** 能力，这使得它不仅能搜索文本，还能"理解"和搜索图像、视频等非结构化数据的内容。
*   **分析与聚合**: 强大的聚合框架，可以快速实现如"按相机型号统计照片数量"、"生成拍摄地点的热力图"等复杂分析。
*   **生态成熟**: 拥有庞大的社区和丰富的工具链，便于监控、管理和集成。

*   **语义搜索 (自然语言)**
    *   **实现原理**: 该功能的核心是将用户的自然语言查询和图库中的媒体内容，都转换为高维度的**向量嵌入 (Vector Embeddings)**，然后在向量空间中进行相似度计算。查询向量与哪个媒体的向量最"接近"，就意味着哪个媒体最符合查询意图。
    *   **技术流程**:
        1.  **媒体向量化 (Indexing Time)**:
            *   **触发**: 在媒体上传或进行 AI 分析时，由 BullMQ 任务队列触发。
            *   **模型**: 调用多模态大语言模型 (如 **Google Gemini** 或 **OpenAI CLIP**) API，输入图片或视频帧。
            *   **输出**: 模型返回一个高维（例如 768 或 1024 维）的浮点数向量，这个向量就是该媒体内容的"数学表示"。
            *   **存储**: Zmage 将这个向量与媒体 ID 一并存入 Elasticsearch 的一个专门索引中，该索引的向量字段类型被配置为 `dense_vector`。
        2.  **查询向量化 (Query Time)**:
            *   **触发**: 用户在搜索框输入自然语言查询，如 *“去年夏天在海边拍的日落照片”*。
            *   **模型**: Zmage 的 BFF 层调用一个文本嵌入模型 (如 **Gemini Text Embedding API**) API，将这段文本查询也转换为一个相同维度的向量。
        3.  **向量检索 (Vector Search)**:
            *   **执行**: Zmage 向 Elasticsearch 发起一个 **k-NN (k-Nearest Neighbors) 搜索**请求。
            *   **算法**: Elasticsearch 使用高效的近似最近邻搜索算法 (如 **HNSW - Hierarchical Navigable Small World**) 在数百万个媒体向量中，快速找出与查询向量**余弦相似度 (Cosine Similarity)** 最高的前 k 个结果。
        4.  **混合搜索与过滤 (Hybrid Search)**:
            *   **意图解析**: 在进行向量搜索的同时，Zmage 的 BFF 层也会用大模型 (Gemini/GPT) 或传统 NLP 技术解析出查询中的结构化意图（如时间："去年夏天"，地点："海边"）。
            *   **后置过滤 (Post-filtering)**: Elasticsearch 的 k-NN 搜索可以与传统的关键词过滤 (`filter`) 结合。这意味着，它会先在符合"去年夏天"、"海边"这些条件的媒体子集中进行向量搜索，极大地提高了查询的精准度和效率。
            *   **结果重排 (Reranking)**: (规划中) 引入重排模型，对初步召回的结果进行二次排序，进一步优化相关性。

*   **视觉相似性搜索 (以图搜图)**
    *   **实现原理**: 与语义搜索类似，但其查询的源头不是文本，而是一张图片。同样基于向量嵌入和 k-NN 搜索。
    *   **技术流程**:
        1.  **查询图片向量化**:
            *   当用户选择一张图片并点击"查找相似"时，Zmage 会提取这张**查询图片**的向量。
            *   如果这张图片是图库内的，其向量已经存在于 Elasticsearch 中，可以直接获取。
            *   如果用户上传了一张外部图片，则会实时调用多模态模型 API，为其生成一个临时查询向量。
        2.  **执行 k-NN 搜索**:
            *   使用这个查询向量，在 Elasticsearch 的媒体向量索引中执行 k-NN 搜索，找出向量空间中最接近的邻居。
            *   这些返回的结果，在视觉内容、构图或艺术风格上，就与查询图片高度相似。
    *   **技术补充 - 感知哈希 (Perceptual Hashing)**:
        *   **目的**: 用于快速识别**内容完全相同或极其相似**（如仅有微小尺寸或压缩差异）的图片，主要用于**去重**，是视觉相似性搜索的一个特例和补充。
        *   **算法**: 使用 `imghash` 等库，在媒体上传时计算其 **pHash (感知哈希)** 或 **dHash (差异哈希)**。这会生成一个简短的（如 64 位）哈希字符串。
        *   **比对**: 通过计算两个哈希字符串的**汉明距离 (Hamming Distance)**，可以极快地判断两张图片的相似度。汉明距离越小，图片越相似。
        *   **存储与查询**: 这些哈希值作为普通关键词 (`keyword`) 存储在 Elasticsearch 或主数据库中，查询时可通过高效的脚本进行距离计算和排序。

### 探索发现 (/explore)

*   **灵感来源**:
    *   **随机图片**: 调用 Lorem Picsum 等API，提供高质量的可带搜索选项随机图片作为创作灵感或占位图。
    *   **网络搜索**: 集成 Google Custom Search 和 SerpApi，允许用户直接在 Zmage 内搜索网络图片。
*   **一键入库**:
    *   所有在"探索"页发现的图片，都提供一个"添加到图库"的按钮，点击后系统将自动执行URL导入流程，无缝融入个人媒体库。

## 3.4 创意工坊：轻量化编辑与 AI 辅助创作

"创意工坊"是 Zmage 的创作中枢，它将基础编辑工具与强大的 AI 能力融为一体，旨在降低创作门槛，释放用户想象力。

### 基础编辑与增强

*   **无损编辑流程**:
    *   **虚拟副本**: 所有编辑均在虚拟副本上进行，不修改原始文件，可随时放弃或另存为新版本。
    *   **操作历史**: 记录每一步编辑操作，可无限撤销/重做。
    *   **预设 (Presets)**: 支持将一套完整的调色和裁剪参数保存为预设，并一键应用到其他图片或批量应用。
*   **核心调整工具**:
    *   **裁剪与旋转**: 支持自由裁剪、固定比例裁剪 (1:1, 16:9 等)、任意角度旋转和水平/垂直翻转。
    *   **调整大小**: 支持按像素或百分比调整尺寸，可锁定宽高比。
    *   **调色**: 精细调整**亮度、对比度、饱和度、色温、色调、锐度**等参数。
*   **实用工具集**:
    *   **批量增强 (/create/enhance)**: 一键对多张图片应用自动色彩和光影校正。
    *   **全景拼接 (/create/panorama)**: 自动识别并拼接多张照片，生成一张宽幅全景图。
    *   **幻灯片制作 (/create/slideshow)**: 选择图片、转场效果和背景音乐，快速生成幻灯片视频。
    *   **智能拼图 (/create/collage)**: 提供多种布局模板，自动将多张图片排列组合成一张拼图。
    *   **图片故事 (/create/story)**: AI辅助生成带有文字和布局的图文故事长图。

### AI 辅助创作 (创作工坊)

*   **一键式魔法 (修复与美化)**
    *   **智能消除**: 涂抹图片中的路人、杂物或水印，AI将智能填充背景。
    *   **画质修复**: 针对低分辨率、有噪点或模糊的旧照片进行高清化和细节增强。
    *   **老照片上色**: 为黑白照片智能上色，还原真实色彩。
    *   **智能抠图 (/create/remove-bg)**: 由 Remove.bg API 提供的高精度主体抠图。
    *   **图片分层**: AI 自动识别并分离图片中的主体、天空、背景等图层，方便单独编辑。
    *   **无损放大**: 采用 AI 算法将图片放大2-8倍，同时保持清晰度。
*   **人像与美颜**
    *   **智能美颜**: 一键实现磨皮、美白、瘦脸、大眼等效果。
    *   **人脸分析**: 识别年龄、性别、情绪等属性。
    *   **皮肤美化**: 智能祛痘、祛斑，保持皮肤质感。
    *   **牙齿美化**: 自动识别并美白牙齿。
    *   **眼部编辑**: 调整眼神光、消除红眼。
    *   **百变发型**: (规划) 为人像尝试不同的发型和发色。
*   **生成式与艺术化**
    *   **GemBooth (/create/gembooth)**: 调用摄像头自拍，并结合提示词进行风格化重绘。
    *   **Co-Drawing (/create/co-drawing)**: 上传简单的手绘草图并配以提示词，AI 将其生成为一张完整的图像。
    *   **Paint-a-Place (/create/paint-a-place)**: 输入一个地名或地址，AI 将其想象并绘制成一张艺术画作。
    *   **风格迁移**: 将照片的风格转换为梵高、水墨、赛博朋克等多种艺术风格。
*   **视频与动态**
    *   **图生 GIF (/create/gif)**: 将一组静态图片或一段视频片段生成为动态 GIF。
    *   **图片转场动画 (I2V) (/create/i2v)**: AI 在两张图片之间生成平滑、富有创意的过渡动画。
    *   **(规划) 视频剪辑**: AI 自动识别视频中的精彩片段并进行剪辑，或根据文字描述生成视频集锦。

### 开发者工坊 (/dev)

这是一个面向高级用户的实验性功能区，旨在快速验证和体验最前沿的开源 AI 模型。

*   **目的**: 直接调用外部托管的 Gradio/Model API，绕过 Zmage 内部的任务队列和格式化流程，实现"原生"调用。
*   **功能**:
    *   **WAN I2V (图生视频)**: 调用 WAN 2.5 预演模型的 Gradio API。
    *   **AnyStory (主体个性化)**: 实现主体分割、二维码、个性化生图等。
    *   **Tora (轨迹文生视频)**: 根据画布轨迹和提示词生成动态视频。
    *   **(规划) olmOCR PDF 处理**: PDF 拆分、OCR、语义提取。
*   **说明**: 本区域接口多为公开 Demo，稳定性与配额受限，主要用于创意验证和技术打样。调用结果将直接存入图库/相册。

为了提升大规模媒体库的管理效率，Zmage 设计了强大的批量操作模式。

*   **进入/退出模式**:
    *   通过点击专用的"多选"按钮或使用键盘快捷键 (如 Ctrl/Cmd + Shift + A) 进入多选模式。
    *   在多选模式下，点击媒体卡片即可勾选/取消勾选。
    *   按 ESC 键或点击"完成"按钮退出多选模式。
*   **浮动操作栏**:
    *   进入多选模式后，页面底部会出现一个固定的浮动操作栏，显示已选中的项目数量，并提供所有可用的批量操作按钮。
*   **支持的批量操作**:
    *   **管理**: **批量删除**、**批量添加到相册**、**批量从相册移除**。
    *   **元数据**: **批量添加/移除标签**、**批量修改评分**、**批量修改拍摄时间** (如时区校正)。
    *   **AI 处理**: **批量触发 AI 分析** (生成标签和描述)。
    *   **创作**: **批量应用预设**、**批量增强**。
    *   **分享与导出**: **批量开启/关闭公开分享**、**批量下载** (打包为.zip文件)。
*   **进度与反馈**:
    *   所有批量操作都会触发一个后台任务，并在 UI 上显示清晰的进度条 (如 "正在分析 3/50")。
    *   操作完成后，会提供一份摘要报告，说明成功、失败和跳过的项目数量，并允许查看详细的错误日志。

## 3.5 情感纽带：安全可控的分享与隐私保护

Zmage 的分享机制，旨在将数字记忆从孤立的存储转变为连接情感的纽带。我们设计的不是简单的"共享链接"，而是一套**分层、可控、安全且富有仪式感**的分享体验。

### 核心分享体系 (v2.0.2 已实现)

*   **单项分享 (Per-Item Sharing)**:
    *   **一键开启/关闭**: 在每个图片/视频卡片上提供快速切换公开分享的开关。
    *   **高熵安全链接**: 开启后生成一个唯一的 `shareId` (72位熵+类型前缀 `i_`/`v_`)，防止暴力猜测。
    *   **链接轮换**: 关闭分享后再开启，会生成一个全新的链接，使旧链接失效，保障安全。
    *   **动态 OG & Twitter 卡片**: 所有公开分享链接在社交媒体上都具有丰富的预览卡片（标题、缩略图）。
    *   **浏览计数**: 实时追踪每个分享链接的浏览次数。
*   **分享中心 (`/share`)**:
    *   **统一管理**: 集中展示用户所有已公开分享的媒体。
    *   **快速操作**: 支持在此处批量复制链接或关闭分享。

### 高级分享模式与权限控制 (设计)

*   **相册分享 (Album Sharing)**:
    *   **整个相册分享**: 支持将一个手动或智能相册以一个链接的形式分享出去。
    *   **多种布局**: 分享的相册页面支持网格、时间轴和地图等多种查看布局。
    *   **动态更新**: 分享的是"活"的相册；所有者后续对相册内容的增删改，会实时反映在分享页面上。
*   **精细化访问控制 (Per-Link Permissions)**:
    *   **密码保护**: 为每个分享链接设置独立的访问密码。
    *   **有效期限定**: 设置链接在特定日期和时间后自动失效。
    *   **访问次数限制**: 链接在被访问 N 次后自动失效。
    *   **下载控制**:
        *   **禁止下载**: 访客只能在线浏览，禁用右键保存和下载按钮。
        *   **下载特定尺寸**: 可设置仅允许下载中等尺寸的预览图，而非原始文件。
    *   **评论权限**: 允许或禁止访客在分享页面发表评论。
*   **演示模式 (Presentation Mode)**:
    *   将分享链接以全屏、自动播放的幻灯片模式打开，适合会议演示或家庭影院播放。

### 多样化分享模式 (设计)

*   **协作相册 (Collaborative Albums)**:
    *   **邀请机制**: 通过邮箱或 Zmage 用户名邀请朋友共同管理一个相册。
    *   **角色权限**:
        *   **查看者**: 仅能浏览和评论。
        *   **贡献者**: 可以上传自己的媒体到相册。
        *   **编辑者**: 可以上传、删除和编辑相册内的任何媒体。
    *   **实时通知**: 当有新成员加入、上传新照片或发表评论时，所有协作者都会收到通知。
*   **访客上传链接 (Guest Upload Links)**:
    *   **活动照片收集**: 为特定事件（如婚礼、派对）生成一个上传专用链接。
    *   **无需注册**: 任何人通过此链接都可以上传照片和视频，无需 Zmage 账户。
    *   **自动整理**: 所有通过此链接上传的媒体会自动进入指定的相册。
    *   **安全设置**: 可设置上传文件的数量、大小和类型限制，并可设置链接有效期。
*   **嵌入式幻灯片 (Embeddable Slideshows)**:
    *   **代码生成**: 自动生成一段 HTML 代码，可轻松将相册的幻灯片嵌入到个人博客、Notion 页面或任何支持 `iframe` 的网站中。
    *   **高度定制**: 支持自定义幻灯片的尺寸、播放速度、是否显示标题等。

### 隐私与安全 (设计)

*   **元数据净化 (Metadata Scrubbing)**:
    *   分享时提供"隐私模式"选项，勾选后，分享出去的媒体版本会自动擦除所有 EXIF 信息，特别是 GPS 地理位置和相机序列号。
*   **数字水印 (Digital Watermarking)**:
    *   **可见水印**: 分享时可选择添加自定义的文字或 Logo 水印，支持调整位置、透明度和大小。
    *   **(规划) 不可见水印**: 嵌入不可见的数字水印，用于版权追踪。
*   **私密空间 (Private Vault)**:
    *   **双重验证**: 一个需要额外密码或生物识别才能访问的加密空间。
    *   **隔离存储**: 存放在此处的媒体在常规视图、搜索和 AI 分析中完全不可见。
    *   **(规划) 端到端加密**: 存储在此处的文件在上传前使用用户密钥进行端到端加密，即使是服务器管理员也无法解密。
*   **分享审计日志 (Sharing Audit Log)**:
    *   **详细记录**: 记录每个分享链接的创建时间、权限变更历史。
    *   **访问追踪**: 记录每次访问的时间、IP 地址、地理位置（概略）、使用的设备。
    *   **下载记录**: 记录每次下载操作的详细信息。
    *   **一键撤销所有分享**: 提供紧急按钮，一键让所有公开分享链接失效。

## 3.6 可持续生态：存储配额与订阅体系

为了保证 Zmage 项目的长期可持续发展，并为用户提供公平、透明且富有弹性的资源管理方案，我们设计了一套精细化的存储配额与订阅体系。该体系的核心理念是：**保障免费用户的核心体验，同时为有更高需求的用户提供清晰、价值驱动的升级路径。**

### 分层存储配额体系

Zmage 的存储配额采用分层设计，以满足从轻度个人用户到专业创作者的不同需求。

*   **免费版 (Free Tier) - `1.2 GB`**:
    *   **定位**: **无门槛体验入口**。旨在让每一位新用户都能无压力地体验 Zmage 的所有核心功能。
    *   **容量**: 1.2 GB 的免费存储空间，足以存储约 300-500 张高质量照片或数十分钟的高清视频，非常适合作为入门或轻度使用。
    *   **功能**: 免费用户可以使用**除少数高级功能外**的绝大部分 Zmage 功能，包括智能相册、基础编辑、AI 分析等，我们确保核心体验不打折扣。
*   **付费版 (Premium Tiers)**:
    *   **个人版 (Personal) - `5 GB` / `20 GB`**:
        *   **定位**: **主流用户与摄影爱好者**。提供更充裕的空间，解锁所有高级功能。
    *   **专业版 (Professional) - `50 GB` / `100 GB`**:
        *   **定位**: **摄影师、设计师、内容创作者**。提供海量存储空间和专业级工作流支持。
    *   **(规划) 企业版 (Enterprise) - `定制化`**:
        *   **定位**: **小型团队与工作室**。提供团队协作、统一计费和专属支持。

### 智能存储管理与预警

我们不仅限制存储，更提供强大的工具来帮助用户理解和管理他们的存储空间。

*   **实时用量仪表盘**:
    *   **动态进度条**: 在 UI 的显著位置（如侧边栏底部），始终显示一个彩色的、动态更新的存储用量进度条，直观展示已用空间、总量和百分比。
    *   **颜色预警**:
        *   **绿色 (< 80%)**: 空间充足。
        *   **黄色 (80% - 90%)**: 空间警告。
        *   **橙色 (90% - 100%)**: 空间严重不足。
        *   **红色 (>= 100%)**: 空间已满，上传功能将被限制。
*   **详细存储分析面板**:
    *   **按媒体类型分解**: 提供一个可视化的图表（如饼图或条形图），详细展示**原始图片、原始视频、缩略图缓存、RAW 文件、AI生成资产**等不同类型文件各自占用的空间。
    *   **按相册/文件夹分解**: 列出占用空间最大的相册，帮助用户定位"存储大户"。
*   **多级预警机制**:
    *   **应用内通知**: 当用量超过 80% 和 90% 时，系统会在用户登录时弹出非侵入式的通知。
    *   **邮件提醒**: 当用量超过 90% 和 100% 时，系统会自动发送邮件提醒，并附上清理建议和升级链接。
    *   **操作前校验**: 在执行任何可能消耗大量空间的操作（如批量上传、视频导入）前，系统会进行**预先检查 (Pre-flight Check)**，如果预估操作会导致超限，将提前警告用户。
*   **智能清理建议 (Storage Cleaner)**:
    *   这是一个主动式的存储优化工具，它会定期在后台扫描用户的媒体库，并以卡片的形式向用户推荐可安全清理的项：
        *   **相似与重复照片**: 利用感知哈希技术，找出内容高度相似的连拍照片或完全重复的文件，建议用户保留最佳的一张。
        *   **低质量媒体**: 识别出严重模糊、过曝/欠曝的照片或体积巨大但分辨率很低的视频。
        *   **大型文件**: 列出图库中体积最大的前 50 个文件，供用户审查。
        *   **"被遗忘"的媒体**: 找出在很长一段时间内（如超过一年）从未被浏览或添加到任何相册的媒体。
        *   **AI 资产**: 列出所有由 AI 生成的、且未被评分或加入相册的图片，用户可决定是否保留。

### 流畅的订阅与支付流程

Zmage 的订阅流程被设计得尽可能简单、透明和无缝。

*   **清晰的计划对比页面**:
    *   提供一个功能矩阵表，清晰地对比不同订阅计划在**存储空间、高级功能（如协作相册、4K视频支持）、AI 调用配额、客服支持级别**等方面的差异。
    *   **价格透明**: 明确展示月付和年付（含折扣）的价格。
*   **一键式升级体验**:
    *   当用户存储空间不足时，所有上传入口都会智能地转变为一个"升级以继续"的按钮，点击即可直接进入已预选了推荐套餐的订阅页面。
    *   **费用按日折算 (Proration)**: 如果用户在当前订阅周期内升级，系统会自动计算剩余价值，并只收取差额，实现无缝、公平的升级。
*   **多支付方式支持**:
    *   集成主流支付网关 (Stripe)，支持**信用卡、支付宝、微信支付**等多种支付方式，满足不同地区用户的习惯。
*   **便捷的订阅管理**:
    *   在"设置"中提供一个专门的"订阅与账单"页面。
    *   **用户可在此**:
        *   查看当前订阅状态、下次续费日期和金额。
        *   随时升级、降级或取消订阅（取消后，当前周期内权益依然有效）。
        *   更新支付方式。
        *   下载所有历史账单和发票。
*   **(规划) 家庭共享订阅 (Family Sharing)**:
    *   允许主账户邀请最多 5 位家庭成员加入共享计划。
    *   **共享存储池**: 所有成员共享一个大的存储池（如 200GB 或 1TB）。
    *   **隐私隔离**: 每个成员的媒体库仍然是完全私密的，彼此不可见。
    *   **统一计费**: 由主账户统一支付费用。

通过这套完整的可持续生态设计，Zmage 不仅为自身的发展提供了动力，更重要的是，它将资源管理的选择权和主动权交还给了用户，将付费行为从一种被动的限制，转变为一种主动的、为了获得更好体验和更大价值的投资。