# Zmage（2025-BS课程作业）— 数字资产系统开发指南（执行版）
作者：周子为（zzw4257）｜809050685@qq.com｜github.com/zzw4257

> 标语  
> **zmage**  
> 图片本无意，因人而生情  
> 光影交错间，记忆永镌刻  
> 零归本真，影像重生  
> 图标：`/brand/icon.png`

## 0. 目标（对齐 Dash：找得到 / 分享协作 / 使用投放）
做一个“**隐私优先的数字资产相册**”，让团队/个人能：
- **Find**：几秒内找到任何图片/视频（文字、物体、场景、人物、日期、地点、项目、自定义字段）。
- **Share & Collaborate**：一键分享链接、集合协作、对外品牌 Portal（可搜索/筛选/下载权限）。
- **Use & Deploy**：下载预设尺寸/裁剪；（可选）嵌入/集成占位（Shopify/Canva/站点嵌入）。

额外必须：**后台自动扫描 + 定期“新相册建议”**（MCP/Agent 驱动）。

## 1. 信息架构（IA）与页面（响应式）
端口：Web `2333`｜API `4257`（详见 `/docs/rules.md`）

### 1.1 导航结构（桌面：侧边栏；移动：底部 Tab）
- **库（Library）**：全局搜索 + 过滤 + 结果网格
- **浏览（Browse）**：按文件夹/字段“封面卡片”浏览（不会 0 结果的推荐过滤）
- **相册（Albums）**：人工相册 / 智能相册 / 建议相册（待审核）
- **分享（Share）**：分享链接 / Portal / 对外投递（Guest upload，可选）
- **设置（Admin）**：字段、权限组、下载预设、品牌化、集成占位

### 1.2 必做页面（MVP）
1) **登录/初次引导**：上传引导 + “从 test_media 试跑”提示  
2) **库（搜索页）**：搜索框（AI/普通可切换）+ 筛选条 + 资产网格 + 批量操作条  
3) **资产详情**：大预览 + 右侧信息栏（字段/标签/版本/相似）+ 快捷下载  
4) **上传**：拖拽/按钮上传；保留文件夹结构（顶层文件夹）；上传时字段必填提示（可“仍然提交”）  
5) **集合（Collection）**：跨文件夹聚合 + 协作（备注/成员）+ 对外分享链接  
6) **Portal（对外）**：品牌化外链，可搜索/筛选/下载（view-only 或 view&download）  
7) **相册页**：创建/编辑相册；**建议相册**列表（查看理由、预览、接受/忽略）  
8) **后台任务状态页（简版）**：上次扫描时间、队列长度、失败重试、手动触发

## 2. UI/UX 规范（macOS 液态玻璃 + 精致克制动态）
### 2.1 视觉
- “液态玻璃”卡片：`backdrop-blur` + 半透明面板 + 细边框 + 微弱高光；背景轻渐变噪点。
- 排版：中文优先，12/14/16/20/28 级别清晰；长文案尽量短句。
- 组件圆角统一（12–16）；阴影软且少层级（避免“漂浮过度”）。

### 2.2 动效（约束）
- 仅用于：状态切换/弹层/列表插入/下载进度。
- 规则：**150–220ms**，缓入缓出；不做大幅位移；尊重 `prefers-reduced-motion`。
- 网格缩略图 hover：只做轻微亮度/边框高光；不做缩放抖动。

### 2.3 交互（高频）
- 多选：hover 勾选；`Shift` 连选；`Cmd/Ctrl+A` 全选；批量下载/加集合/分享。
- 搜索：默认即时；支持引号、AND/OR/NOT；AI 搜索开关在同一处（可对比）。
- 过滤：字段、文件类型、时间、来源；**推荐过滤**只展示不会导致 0 结果的选项。

## 3. 功能清单（必须实现）
### 3.1 资产与组织
- 上传：拖拽 + Add；保留文件夹结构；重复文件检测（哈希去重）。
- 文件夹：层级结构；移动/重命名（权限控制）。
- 自定义字段（Fields）：文本/单选/多选/日期/数字；上传页可新建；支持“必填但可跳过”。
- 自动元数据：EXIF/IPTC 基础解析 → 映射到字段（至少：拍摄时间/设备/尺寸/时长）。

### 3.2 智能（全部依赖 Gemini）
- **自动标签**：物体/场景/图片文字（OCR）→ 写入标签与字段。
- **语义检索**：文本 → 向量检索；结合关键词过滤（混合检索）。
- **相似图片**：资产详情页 “相似推荐”（向量近邻）。
- **智能相册建议（后台定期扫描）**：
  - 输入：近 N 天新增资产 + 最近活跃资产。
  - 输出：候选相册（标题/封面/理由/包含资产）→ 进入“建议”池，由用户一键接受。
  - 规则：按时间段/地点/人物/事件语义聚类；并对“重复/近似/连拍”做合并。

### 3.3 分享与交付
- 分享链接：单资产/集合；可设到期/下载权限/密码。
- Portal：可配置欢迎语、主题、可见字段、可搜索范围、下载权限。
- 下载：原图/预设尺寸/格式；批量 zip；裁剪预设（至少 1:1、16:9、4:5）。
- 版本：上传新版本（替换/追加）；版本历史可下载；（可选）通知曾下载者。

## 4. 非功能要求（验收硬指标）
- **中文文案**统一、克制、高级；错误提示可操作（告诉用户下一步）。
- **移动端可用**：关键页（库/详情/上传/相册/分享）不牺牲功能。
- **不使用 mock 媒体**：联调与演示必须用根目录 `/test_media` 的 png/jpg/mp4。
- **Docker 一键启动**：`docker compose up --build` 后即可打开 Web/API，环境差异最小。

## 5. 验收清单（基础要求全覆盖）
- [ ] 上传 png/jpg/mp4（来自 `/test_media`）→ 自动打标/入库/可搜索
- [ ] 关键词 + AI 搜索切换可用；字段过滤可用
- [ ] 资产详情：字段编辑、相似推荐、下载预设
- [ ] 集合协作 + 分享链接（权限/到期）
- [ ] Portal（品牌化）可搜索/筛选/下载控制
- [ ] 后台“相册建议”按计划生成；前台可 Accept/Ignore
- [ ] Docker 一键启动；端口固定 2333/4257
